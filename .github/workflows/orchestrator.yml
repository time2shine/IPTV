name: "⏱️ Orchestrate EPG Pipeline"

on:
  schedule:
    - cron: "0 */4 * * *"     # every 4 hours (UTC)
  workflow_dispatch: {}       # manual: runs the full chain

# Use a DIFFERENT concurrency group than the child workflows to avoid deadlock
concurrency:
  group: epg-orchestrator-${{ github.ref_name }}
  cancel-in-progress: false

permissions:
  contents: write

jobs:
  update_json_status:
    name: "1️⃣ 🛰️ Update JSON Status"
    uses: ./.github/workflows/update_json_status.yml
    secrets: inherit

  youtube_playlist:
    name: "2️⃣ 🎣 Build YouTube Playlist"
    needs: [update_json_status]
    uses: ./.github/workflows/youtube_playlist.yml
    secrets: inherit

  combine_playlists:
    name: "3️⃣ 🔀 Combine YouTube & Static IPTV Links"
    needs: [youtube_playlist]
    uses: ./.github/workflows/combine_playlists.yml
    secrets: inherit

  epg:
    name: "4️⃣ 🧭📺 Generate & Publish EPG"
    needs: [combine_playlists]
    uses: ./.github/workflows/epg.yml
    secrets: inherit
